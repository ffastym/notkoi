import{j as e,a as l,F,b as k,B as P,u as ue,g as q,c as he,d as pe,C as D,e as z,f as j,h as ge,i as fe,k as me,l as be,s as Y,m as xe,n as ye,r,o as ve,p as Be,q as Ce,t as Ie,L as we,H as Te,v as Le,R as ke,w as Fe,A as Pe,x as Se}from"./index-20db1dad.js";function Ve({percent:t}){return e("div",{className:"progress",children:e("div",{className:"progress-bar",role:"progressbar",style:{height:`${t}%`}})})}function S({children:t,title:i,accept:n,reject:s,visible:u,onClose:g}){return u?e("div",{style:{zIndex:999,position:"fixed",background:"rgba(0,0,0,0.8)",left:0,top:0,right:0,bottom:0},children:l(F,{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%,-50%)",maxHeight:"500px",width:"80%",background:"var(--tg-theme-secondary-bg-color)",borderRadius:"25px"},children:[e("div",{style:{padding:"16px"},children:l("span",{style:{fontSize:"20px",fontWeight:"bold",color:"var(--tg-theme-text-color)",textAlign:"center",display:"block"},children:[i,g&&e("button",{className:"close",onClick:g})]})}),e("div",{style:{flex:1,padding:"0 16px"},children:t}),n||s?l(k,{style:{padding:"16px"},children:[n&&e(P,{onClick:n.action,children:n.text}),s&&e(P,{onClick:s.action,children:s.text})]}):e("div",{style:{height:16}})]})}):null}function G({children:t}){return l("div",{style:{display:"flex",alignItems:"center",flexDirection:"column"},children:[e("img",{style:{height:100,width:100},src:"/img/coming-soon.png",alt:""}),e("span",{style:{marginTop:16,fontWeight:500,textAlign:"center"},children:t})]})}function Ne({isVisible:t,hide:i}){const{data:n}=ue({fetchPolicy:"cache-and-network"});return n?e(S,{visible:t,title:"Profile",onClose:i,accept:{text:"OK",action:i},children:e(G,{children:"Your profile information, stats and achievements"})}):null}function Ue({isVisible:t,hide:i}){return e(S,{visible:t,title:"Leaderboard",accept:{text:"OK",action:i},children:e(G,{children:"Your score in the fisherman rating"})})}const Z={},A=q`
  fragment MainBox on Box {
    id
    baitsLevel
    baitsLevelUpdateTonCost
    baitsLevelUpdateCoinsCost
    baitsLevelUpdateForCoinsPossible
    equipmentLevel
    equipmentLevelUpdateForCoinsPossible
    equipmentLevelUpdateTonCost
    equipmentLevelUpdateCoinsCost
  }
`,Ee=q`
  query TackleBox($boxId: String!) {
    tackleBox(boxId: $boxId) {
      ...MainBox
    }
  }
  ${A}
`;function qe(t){const i={...Z,...t};return he(Ee,i)}const Ae=q`
  mutation UpgradeBox($boxId: ID!, $boxItemType: BoxItemType!) {
    upgradeBox(boxId: $boxId, boxItemType: $boxItemType) {
      ...MainBox
    }
  }
  ${A}
`;function He(t){const i={...Z,...t};return pe(Ae,i)}const Q=({locked:t,tonCost:i,coinsCost:n,level:s,picture:u,name:g,boxId:b,boxItemType:x})=>{const[f]=He({fetchPolicy:"no-cache"}),B=d=>{j.cache.updateFragment({fragment:A,id:`Box:${d.id}`},()=>d)};return l(F,{children:[l(k,{children:[e("img",{style:{height:40,width:40,marginRight:8},src:u,alt:""}),l(F,{children:[e("span",{style:{fontWeight:"bold"},children:g}),l("span",{style:{color:"var(--tg-theme-hint-color)"},children:["Level ",s]})]})]}),l(k,{children:[e(P,{disabled:t,onClick:async()=>{var m;if(t)return;const d=await f({variables:{boxId:b,boxItemType:x}});d.data&&(window.Telegram.WebApp.HapticFeedback.notificationOccurred("success"),B((m=d.data)==null?void 0:m.upgradeBox))},style:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},children:l(k,{style:{opacity:t?"0.6":1},children:[t&&e("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e("g",{id:"Iconly/Bold/Lock",children:e("g",{id:"Lock",children:e("path",{id:"Lock_2",fillRule:"evenodd",clipRule:"evenodd",d:"M17.5227 7.39601V8.92935C19.2451 9.46696 20.5 11.0261 20.5 12.8884V17.8253C20.5 20.1308 18.5886 22 16.2322 22H7.7688C5.41136 22 3.5 20.1308 3.5 17.8253V12.8884C3.5 11.0261 4.75595 9.46696 6.47729 8.92935V7.39601C6.48745 4.41479 8.95667 2 11.9848 2C15.0535 2 17.5227 4.41479 17.5227 7.39601ZM12.0051 3.73904C14.0678 3.73904 15.7445 5.37871 15.7445 7.39601V8.7137H8.25553V7.37613C8.26569 5.36878 9.94232 3.73904 12.0051 3.73904ZM12.8891 16.4549C12.8891 16.9419 12.4928 17.3294 11.9949 17.3294C11.5072 17.3294 11.1109 16.9419 11.1109 16.4549V14.2488C11.1109 13.7718 11.5072 13.3843 11.9949 13.3843C12.4928 13.3843 12.8891 13.7718 12.8891 14.2488V16.4549Z",fill:"#200E32"})})})}),e(D,{coins:n,type:z.COIN})]})}),e(P,{style:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},children:e(D,{coins:i,type:z.TON})})]})]})};var E=(t=>(t.Baits="BAITS",t.Equipment="EQUIPMENT",t))(E||{});function Oe({isVisible:t,hide:i,tackleBoxId:n}){const{data:s,loading:u}=qe({fetchPolicy:"cache-and-network",variables:{boxId:n}});return e(S,{visible:t,title:"Tackle box",onClose:i,children:(()=>{if(!s)return u?e("span",{children:"Loading..."}):null;const{equipmentLevel:b,equipmentLevelUpdateTonCost:x,baitsLevel:f,baitsLevelUpdateCoinsCost:B,baitsLevelUpdateForCoinsPossible:C,baitsLevelUpdateTonCost:d,equipmentLevelUpdateForCoinsPossible:m,equipmentLevelUpdateCoinsCost:w,id:I}=s.tackleBox;return l(F,{children:[e(Q,{name:"Fishing equipment",coinsCost:w,tonCost:x,level:b,locked:!m,picture:"/img/equipment.png",boxId:I,boxItemType:E.Equipment}),e("div",{style:{width:"100%",height:1,opacity:.1,background:"var(--tg-theme-text-color)",margin:"8px 0"}}),e(Q,{name:"Fishing baits",coinsCost:B,tonCost:d,level:f,locked:!C,picture:"/img/worm.png",boxId:I,boxItemType:E.Baits})]})})()})}function Re({isVisible:t,biting:i,sell:n,release:s}){return e(S,{visible:t,title:"You catch the fish!",accept:{text:l(ge,{children:[e("span",{style:{color:"#fff"},children:"Sell"}),e("img",{style:{margin:"0 5px 0 10px",height:16,width:16},src:"/img/coin.png",alt:""}),e("span",{style:{color:"#fff"},children:i.fish.price})]}),action:()=>n(i.id)},reject:{text:"Release",action:()=>s(i.id)},children:l("div",{style:{display:"flex",alignItems:"center",flexDirection:"column"},children:[e("img",{style:{maxWidth:"100%",maxHeight:"100%"},src:`/img/fish/${i.fish.picture}`,alt:""}),e("span",{style:{fontSize:18,fontWeight:500},children:i.fish.name})]})})}function $e({buttons:t}){return e(fe,{children:t.map(({action:i,picture:n})=>e(me,{children:e(be,{onClick:i,src:n,alt:n})},n))})}function Me({onPull:t,onPush:i}){return e("button",{onTouchStart:t,onTouchEnd:i,style:{display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"50%",zIndex:1,position:"absolute",right:16,bottom:100,background:"rgba(255,255,255,.3)",border:"2px solid #fff",height:100,width:100},children:e("img",{style:{height:50,width:50},src:"/img/reels-2-white.png",alt:""})})}const We=Y.div`
  min-height: 100vh;
`,De=Y.div`
  max-width: 900px;
  margin: 0 auto;
`;let v=null,p=null;const ze=.5,L=[50,35];function je({user:t}){const{tg:i}=xe(),n=ye(),[s,u]=r.useState(L[1]),[g,b]=r.useState(L[0]),[x,f]=r.useState(null),[B,C]=r.useState(!1),[d,m]=r.useState(!1),[w,I]=r.useState(!1),[H,O]=r.useState(!1),[y,R]=r.useState(0),{data:c}=ve({shouldResubscribe:!0,fetchPolicy:"no-cache"}),[$,{data:M}]=Be({fetchPolicy:"no-cache"}),[K]=Ce({fetchPolicy:"no-cache"}),[_]=Ie({fetchPolicy:"no-cache"}),T=()=>{clearInterval(v),v=null,clearInterval(p),p=0,u(L[1]),b(L[0]),f(null),R(0)},h=o=>{o.preventDefault()},X=o=>{h(o),y&&(clearInterval(v),p||(p=setInterval(V,50)),v=setInterval(()=>{window.Telegram.WebApp.HapticFeedback.impactOccurred("light"),f(a=>a===null?1:a>=100?(W(),T(),100):(s>0&&u(U=>U-ze),a+y))},50))},J=o=>{h(o),y&&(clearInterval(v),p||(p=setInterval(V,50)),v=setInterval(()=>{f(a=>a===null?1:a<=0?(W(),T(),0):(s!==40&&u(U=>U+.05),a-y))},50))},V=()=>{b(o=>{if(o===0||o===100)return o;const a=Math.random();return o+(a>.5?.2:-.2)})},ee=()=>{C(!0)},N=()=>{C(!1),T()},te=()=>{m(!0)},ie=()=>{m(!1)},ne=()=>{n(Fe(Pe.FRIENDS))},oe=()=>{I(!0)},se=()=>{I(!1)},W=()=>{try{i.HapticFeedback.notificationOccurred("error"),i.showAlert("Oops... Your fish is gone ðŸ˜¢. Try to pull the fish more carefully")}catch(o){console.error(o)}},ae=()=>{O(!0)},le=()=>{O(!1)};r.useEffect(()=>{s<=0&&(c!=null&&c.biting)&&$({variables:{bitingId:c.biting.id}}).then(()=>{window.Telegram.WebApp.HapticFeedback.impactOccurred("rigid"),ee(),T()})},[s,c==null?void 0:c.biting,$]),r.useEffect(()=>{c!=null&&c.biting&&(R(c.biting.power),window.Telegram.WebApp.HapticFeedback.notificationOccurred("success"),p||(p=setInterval(V,50)))},[c]);const ce=o=>{j.cache.updateFragment({fragment:Se,id:`User:${t.id}`},a=>({...a,coins:a.coins+o}))},re=async o=>{const{data:a}=await K({variables:{bitingId:o}});a&&(ce(a.sellFish),window.Telegram.WebApp.HapticFeedback.notificationOccurred("success")),N()},de=async o=>{const{data:a}=await _({variables:{bitingId:o}});a&&window.Telegram.WebApp.HapticFeedback.notificationOccurred("success"),N()};return r.useEffect(()=>{i.expand()},[i]),e(We,{children:l(De,{children:[e(we,{onTouchStart:h,onTouchEnd:h}),e(Te,{coins:t.coins,style:{color:"#fff"}}),x!==null&&e(Ve,{percent:100-x}),e(Le,{onTouchStart:h,onTouchEnd:h,style:{bottom:`${s}%`,left:`${g}%`}}),e(ke,{onTouchStart:h,onTouchEnd:h}),y>0&&e("h1",{style:{color:"white",position:"absolute",top:100,left:"50%",transform:"translateX(-50%"},children:"BITING!!!"}),e($e,{buttons:[{picture:"/img/toolbox.png",action:te},{picture:"/img/leaderboard.png",action:oe},{picture:"/img/support.png",action:ne},{picture:"/img/fisher.png",action:ae}]}),y>0&&e(Me,{onPull:X,onPush:J}),M&&e(Re,{hide:N,isVisible:B,sell:re,release:de,biting:M.catchFish}),d&&e(Oe,{isVisible:d,hide:ie,tackleBoxId:t.tackleBoxId}),w&&e(Ue,{isVisible:w,hide:se}),H&&e(Ne,{hide:le,isVisible:H})]})})}export{je as default};
