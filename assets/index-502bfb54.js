import{r as w,u as pe,v as me,D as xe,i as z,e as ye,j as t,a as h,F as E,b as D,B as R,g as S,U as G,c as Z,d as Ce,C as j,f as Q,h as K,k as Be,l as Ie,m as we,n as Te,s as X,o as ke,p as Pe,q as p,t as Le,w as Se,x as Fe,L as Ue,H as De,y as Ee,R as Re,z as Ve,A as _e}from"./index-faaa539f.js";function qe(i,e){var o=w.useRef(!1),a=pe(e==null?void 0:e.client);me(i,xe.Subscription);var f=w.useState({loading:!(e!=null&&e.skip),error:void 0,data:void 0,variables:e==null?void 0:e.variables}),b=f[0],m=f[1];o.current||(o.current=!0,e!=null&&e.onSubscriptionData&&globalThis.__DEV__!==!1&&z.warn(e.onData?52:53),e!=null&&e.onSubscriptionComplete&&globalThis.__DEV__!==!1&&z.warn(e.onComplete?54:55));var B=w.useState(function(){return e!=null&&e.skip?null:a.subscribe({query:i,variables:e==null?void 0:e.variables,fetchPolicy:e==null?void 0:e.fetchPolicy,context:e==null?void 0:e.context})}),x=B[0],y=B[1],g=w.useRef(!1);w.useEffect(function(){return function(){g.current=!0}},[]);var n=w.useRef({client:a,subscription:i,options:e});return w.useEffect(function(){var d,C,l,r,u=e==null?void 0:e.shouldResubscribe;typeof u=="function"&&(u=!!u(e)),e!=null&&e.skip?(!(e!=null&&e.skip)!=!(!((d=n.current.options)===null||d===void 0)&&d.skip)||g.current)&&(m({loading:!1,data:void 0,error:void 0,variables:e==null?void 0:e.variables}),y(null),g.current=!1):(u!==!1&&(a!==n.current.client||i!==n.current.subscription||(e==null?void 0:e.fetchPolicy)!==((C=n.current.options)===null||C===void 0?void 0:C.fetchPolicy)||!(e!=null&&e.skip)!=!(!((l=n.current.options)===null||l===void 0)&&l.skip)||!ye(e==null?void 0:e.variables,(r=n.current.options)===null||r===void 0?void 0:r.variables))||g.current)&&(m({loading:!0,data:void 0,error:void 0,variables:e==null?void 0:e.variables}),y(a.subscribe({query:i,variables:e==null?void 0:e.variables,fetchPolicy:e==null?void 0:e.fetchPolicy,context:e==null?void 0:e.context})),g.current=!1),Object.assign(n.current,{client:a,subscription:i,options:e})},[a,i,e,g.current]),w.useEffect(function(){if(x){var d=!1,C=x.subscribe({next:function(l){var r,u;if(!d){var k={loading:!1,data:l.data,error:void 0,variables:e==null?void 0:e.variables};m(k),!((r=n.current.options)===null||r===void 0)&&r.onData?n.current.options.onData({client:a,data:k}):!((u=n.current.options)===null||u===void 0)&&u.onSubscriptionData&&n.current.options.onSubscriptionData({client:a,subscriptionData:k})}},error:function(l){var r,u;d||(m({loading:!1,data:void 0,error:l,variables:e==null?void 0:e.variables}),(u=(r=n.current.options)===null||r===void 0?void 0:r.onError)===null||u===void 0||u.call(r,l))},complete:function(){var l,r;d||(!((l=n.current.options)===null||l===void 0)&&l.onComplete?n.current.options.onComplete():!((r=n.current.options)===null||r===void 0)&&r.onSubscriptionComplete&&n.current.options.onSubscriptionComplete())}});return function(){d=!0,setTimeout(function(){C.unsubscribe()})}}},[x]),b}function Ne({percent:i}){return t("div",{className:"progress",children:t("div",{className:"progress-bar",role:"progressbar",style:{height:`${i}%`}})})}function V({children:i,title:e,accept:o,reject:a,visible:f,onClose:b}){return f?t("div",{style:{zIndex:999,position:"fixed",background:"rgba(0,0,0,0.8)",left:0,top:0,right:0,bottom:0},children:h(E,{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%,-50%)",maxHeight:"500px",width:"80%",background:"var(--tg-theme-secondary-bg-color)",borderRadius:"25px"},children:[t("div",{style:{padding:"16px"},children:h("span",{style:{fontSize:"20px",fontWeight:"bold",color:"var(--tg-theme-text-color)",textAlign:"center",display:"block"},children:[e,b&&t("button",{className:"close",onClick:b})]})}),t("div",{style:{flex:1,padding:"0 16px"},children:i}),o||a?h(D,{style:{padding:"16px"},children:[o&&t(R,{onClick:o.action,children:o.text}),a&&t(R,{onClick:a.action,children:a.text})]}):t("div",{style:{height:16}})]})}):null}function J({children:i}){return h("div",{style:{display:"flex",alignItems:"center",flexDirection:"column"},children:[t("img",{style:{height:100,width:100},src:"/img/coming-soon.png",alt:""}),t("span",{style:{marginTop:16,fontWeight:500,textAlign:"center"},children:i})]})}const ee={},Oe=S`
  subscription Biting {
    biting {
      id
      power
    }
  }
`;function $e(i){const e={...ee,...i};return qe(Oe,e)}const Ae=S`
  query User {
    user {
      ...UserProfile
    }
  }
  ${G}
`;function He(i){const e={...ee,...i};return Z(Ae,e)}function Me({isVisible:i,hide:e}){const{data:o}=He({fetchPolicy:"cache-and-network"});return o?t(V,{visible:i,title:"Profile",onClose:e,accept:{text:"OK",action:e},children:t(J,{children:"Your profile information, stats and achievements"})}):null}function We({isVisible:i,hide:e}){return t(V,{visible:i,title:"Leaderboard",accept:{text:"OK",action:e},children:t(J,{children:"Your score in the fisherman rating"})})}const te={},$=S`
  fragment MainBox on Box {
    id
    baitsLevel
    baitsLevelUpdateTonCost
    baitsLevelUpdateCoinsCost
    baitsLevelUpdateForCoinsPossible
    equipmentLevel
    equipmentLevelUpdateForCoinsPossible
    equipmentLevelUpdateTonCost
    equipmentLevelUpdateCoinsCost
  }
`,ze=S`
  query TackleBox($boxId: String!) {
    tackleBox(boxId: $boxId) {
      ...MainBox
    }
  }
  ${$}
`;function je(i){const e={...te,...i};return Z(ze,e)}const Qe=S`
  mutation UpgradeBox($boxId: ID!, $boxItemType: BoxItemType!) {
    upgradeBox(boxId: $boxId, boxItemType: $boxItemType) {
      ...MainBox
    }
  }
  ${$}
`;function Ye(i){const e={...te,...i};return Ce(Qe,e)}const Y=({locked:i,tonCost:e,coinsCost:o,level:a,picture:f,name:b,boxId:m,boxItemType:B})=>{const[x]=Ye({fetchPolicy:"no-cache"}),y=n=>{K.cache.updateFragment({fragment:$,id:`Box:${n.id}`},()=>n)};return h(E,{children:[h(D,{children:[t("img",{style:{height:40,width:40,marginRight:8},src:f,alt:""}),h(E,{children:[t("span",{style:{fontWeight:"bold"},children:b}),h("span",{style:{color:"var(--tg-theme-hint-color)"},children:["Level ",a]})]})]}),h(D,{children:[t(R,{disabled:i,onClick:async()=>{var d;if(i)return;const n=await x({variables:{boxId:m,boxItemType:B}});n.data&&(window.Telegram.WebApp.HapticFeedback.notificationOccurred("success"),y((d=n.data)==null?void 0:d.upgradeBox))},style:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},children:h(D,{style:{opacity:i?"0.6":1},children:[i&&t("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:t("g",{id:"Iconly/Bold/Lock",children:t("g",{id:"Lock",children:t("path",{id:"Lock_2",fillRule:"evenodd",clipRule:"evenodd",d:"M17.5227 7.39601V8.92935C19.2451 9.46696 20.5 11.0261 20.5 12.8884V17.8253C20.5 20.1308 18.5886 22 16.2322 22H7.7688C5.41136 22 3.5 20.1308 3.5 17.8253V12.8884C3.5 11.0261 4.75595 9.46696 6.47729 8.92935V7.39601C6.48745 4.41479 8.95667 2 11.9848 2C15.0535 2 17.5227 4.41479 17.5227 7.39601ZM12.0051 3.73904C14.0678 3.73904 15.7445 5.37871 15.7445 7.39601V8.7137H8.25553V7.37613C8.26569 5.36878 9.94232 3.73904 12.0051 3.73904ZM12.8891 16.4549C12.8891 16.9419 12.4928 17.3294 11.9949 17.3294C11.5072 17.3294 11.1109 16.9419 11.1109 16.4549V14.2488C11.1109 13.7718 11.5072 13.3843 11.9949 13.3843C12.4928 13.3843 12.8891 13.7718 12.8891 14.2488V16.4549Z",fill:"#200E32"})})})}),t(j,{coins:o,type:Q.COIN})]})}),t(R,{style:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},children:t(j,{coins:e,type:Q.TON})})]})]})};var O=(i=>(i.Baits="BAITS",i.Equipment="EQUIPMENT",i))(O||{});function Ge({isVisible:i,hide:e,tackleBoxId:o}){const{data:a,loading:f}=je({fetchPolicy:"cache-and-network",variables:{boxId:o}});return t(V,{visible:i,title:"Tackle box",onClose:e,children:(()=>{if(!a)return f?t("span",{children:"Loading..."}):null;const{equipmentLevel:m,equipmentLevelUpdateTonCost:B,baitsLevel:x,baitsLevelUpdateCoinsCost:y,baitsLevelUpdateForCoinsPossible:g,baitsLevelUpdateTonCost:n,equipmentLevelUpdateForCoinsPossible:d,equipmentLevelUpdateCoinsCost:C,id:l}=a.tackleBox;return h(E,{children:[t(Y,{name:"Fishing equipment",coinsCost:C,tonCost:B,level:m,locked:!d,picture:"/img/equipment.png",boxId:l,boxItemType:O.Equipment}),t("div",{style:{width:"100%",height:1,opacity:.1,background:"var(--tg-theme-text-color)",margin:"8px 0"}}),t(Y,{name:"Fishing baits",coinsCost:y,tonCost:n,level:x,locked:!g,picture:"/img/worm.png",boxId:l,boxItemType:O.Baits})]})})()})}function Ze({isVisible:i,biting:e,sell:o,release:a}){return t(V,{visible:i,title:"You catch the fish!",accept:{text:h(Be,{children:[t("span",{style:{color:"#fff"},children:"Sell"}),t("img",{style:{margin:"0 5px 0 10px",height:16,width:16},src:"/img/coin.png",alt:""}),t("span",{style:{color:"#fff"},children:e.fish.price})]}),action:()=>o(e.id)},reject:{text:"Release",action:()=>a(e.id)},children:h("div",{style:{display:"flex",alignItems:"center",flexDirection:"column"},children:[t("img",{style:{maxWidth:"100%",maxHeight:"100%"},src:`/img/fish/${e.fish.picture}`,alt:""}),t("span",{style:{fontSize:18,fontWeight:500},children:e.fish.name})]})})}function Ke({buttons:i}){return t(Ie,{children:i.map(({action:e,picture:o})=>t(we,{children:t(Te,{onClick:e,src:o,alt:o})},o))})}function Xe({onPull:i,onPush:e}){return t("button",{onTouchStart:i,onTouchEnd:e,style:{display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"50%",zIndex:1,position:"absolute",right:16,bottom:100,background:"rgba(255,255,255,.3)",border:"2px solid #fff",height:100,width:100},children:t("img",{style:{height:50,width:50},src:"/img/reels-2-white.png",alt:""})})}const Je=X.div`
  min-height: 100vh;
`,et=X.div`
  max-width: 900px;
  margin: 0 auto;
`;let L=null,T=null;const tt=.5,U=[50,35];function nt({user:i,balance:e}){const{tg:o}=ke(),a=Pe(),[f,b]=p.useState(U[1]),[m,B]=p.useState(U[0]),[x,y]=p.useState(null),[g,n]=p.useState(!1),[d,C]=p.useState(!1),[l,r]=p.useState(!1),[u,k]=p.useState(!1),[P,A]=p.useState(0),{data:v}=$e({shouldResubscribe:!0,fetchPolicy:"no-cache"}),[H,{data:M}]=Le({fetchPolicy:"no-cache"}),[ie]=Se({fetchPolicy:"no-cache"}),[ne]=Fe({fetchPolicy:"no-cache"}),F=()=>{clearInterval(L),L=null,clearInterval(T),T=0,b(U[1]),B(U[0]),y(null),A(0)},I=s=>{s.preventDefault()},oe=s=>{I(s),P&&(clearInterval(L),T||(T=setInterval(_,50)),L=setInterval(()=>{window.Telegram.WebApp.HapticFeedback.impactOccurred("light"),y(c=>c===null?1:c>=100?(W(),F(),100):(f>0&&b(N=>N-tt),c+P))},50))},ae=s=>{I(s),P&&(clearInterval(L),T||(T=setInterval(_,50)),L=setInterval(()=>{y(c=>c===null?1:c<=0?(W(),F(),0):(f!==40&&b(N=>N+.05),c-P))},50))},_=()=>{B(s=>{if(s===0||s===100)return s;const c=Math.random();return s+(c>.5?.2:-.2)})},re=()=>{n(!0)},q=()=>{n(!1),F()},le=()=>{C(!0)},se=()=>{C(!1)},ce=()=>{a(Ve(_e.FRIENDS))},de=()=>{r(!0)},ue=()=>{r(!1)},W=()=>{try{o.HapticFeedback.notificationOccurred("error"),o.showAlert("Oops... Your fish is gone 😢. Try to pull the fish more carefully")}catch(s){console.error(s)}},fe=()=>{k(!0)},he=()=>{k(!1)};p.useEffect(()=>{f<=0&&(v!=null&&v.biting)&&H({variables:{bitingId:v.biting.id}}).then(()=>{window.Telegram.WebApp.HapticFeedback.impactOccurred("rigid"),re(),F()})},[f,v==null?void 0:v.biting,H]),p.useEffect(()=>{v!=null&&v.biting&&(A(v.biting.power),window.Telegram.WebApp.HapticFeedback.notificationOccurred("success"),T||(T=setInterval(_,50)))},[v]);const ve=s=>{K.cache.updateFragment({fragment:G,id:`User:${i.id}`},c=>({...c,coins:+c.coins+s}))},be=async s=>{const{data:c}=await ie({variables:{bitingId:s}});c&&(ve(c.sellFish),window.Telegram.WebApp.HapticFeedback.notificationOccurred("success")),q()},ge=async s=>{const{data:c}=await ne({variables:{bitingId:s}});c&&window.Telegram.WebApp.HapticFeedback.notificationOccurred("success"),q()};return p.useEffect(()=>{o.expand()},[o]),t(Je,{children:h(et,{children:[t(Ue,{onTouchStart:I,onTouchEnd:I}),t(De,{coins:+i.coins,style:{color:"#fff"},balance:e}),x!==null&&t(Ne,{percent:100-x}),t(Ee,{onTouchStart:I,onTouchEnd:I,style:{bottom:`${f}%`,left:`${m}%`}}),t(Re,{onTouchStart:I,onTouchEnd:I}),P>0&&t("h1",{style:{color:"white",position:"absolute",top:100,left:"50%",transform:"translateX(-50%"},children:"BITING!!!"}),t(Ke,{buttons:[{picture:"/img/toolbox.png",action:le},{picture:"/img/leaderboard.png",action:de},{picture:"/img/support.png",action:ce},{picture:"/img/fisher.png",action:fe}]}),P>0&&t(Xe,{onPull:oe,onPush:ae}),M&&t(Ze,{hide:q,isVisible:g,sell:be,release:ge,biting:M.catchFish}),d&&t(Ge,{isVisible:d,hide:se,tackleBoxId:i.tackleBoxId}),l&&t(We,{isVisible:l,hide:ue}),u&&t(Me,{hide:he,isVisible:u})]})})}export{nt as default};
