import{j as e,a,F,b as k,B as P,u as he,g as E,c as pe,d as ge,C as z,e as Q,f as Y,h as fe,i as me,k as be,l as xe,s as G,m as ye,n as ve,r as u,o as Be,p as Ce,q as Ie,t as we,L as Te,H as Le,v as ke,R as Fe,w as Pe,A as Se,x as Ve}from"./index-6f884247.js";function Ne({percent:t}){return e("div",{className:"progress",children:e("div",{className:"progress-bar",role:"progressbar",style:{height:`${t}%`}})})}function S({children:t,title:i,accept:n,reject:l,visible:c,onClose:h}){return c?e("div",{style:{zIndex:999,position:"fixed",background:"rgba(0,0,0,0.8)",left:0,top:0,right:0,bottom:0},children:a(F,{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%,-50%)",maxHeight:"500px",width:"80%",background:"var(--tg-theme-secondary-bg-color)",borderRadius:"25px"},children:[e("div",{style:{padding:"16px"},children:a("span",{style:{fontSize:"20px",fontWeight:"bold",color:"var(--tg-theme-text-color)",textAlign:"center",display:"block"},children:[i,h&&e("button",{className:"close",onClick:h})]})}),e("div",{style:{flex:1,padding:"0 16px"},children:t}),n||l?a(k,{style:{padding:"16px"},children:[n&&e(P,{onClick:n.action,children:n.text}),l&&e(P,{onClick:l.action,children:l.text})]}):e("div",{style:{height:16}})]})}):null}function Z({children:t}){return a("div",{style:{display:"flex",alignItems:"center",flexDirection:"column"},children:[e("img",{style:{height:100,width:100},src:"/img/coming-soon.png",alt:""}),e("span",{style:{marginTop:16,fontWeight:500,textAlign:"center"},children:t})]})}function Ue({isVisible:t,hide:i}){const{data:n}=he({fetchPolicy:"cache-and-network"});return n?e(S,{visible:t,title:"Profile",onClose:i,accept:{text:"OK",action:i},children:e(Z,{children:"Your profile information, stats and achievements"})}):null}function qe({isVisible:t,hide:i}){return e(S,{visible:t,title:"Leaderboard",accept:{text:"OK",action:i},children:e(Z,{children:"Your score in the fisherman rating"})})}const K={},A=E`
  fragment MainBox on Box {
    id
    baitsLevel
    baitsLevelUpdateTonCost
    baitsLevelUpdateCoinsCost
    baitsLevelUpdateForCoinsPossible
    equipmentLevel
    equipmentLevelUpdateForCoinsPossible
    equipmentLevelUpdateTonCost
    equipmentLevelUpdateCoinsCost
  }
`,Ee=E`
  query TackleBox($boxId: String!) {
    tackleBox(boxId: $boxId) {
      ...MainBox
    }
  }
  ${A}
`;function Ae(t){const i={...K,...t};return pe(Ee,i)}const He=E`
  mutation UpgradeBox($boxId: ID!, $boxItemType: BoxItemType!) {
    upgradeBox(boxId: $boxId, boxItemType: $boxItemType) {
      ...MainBox
    }
  }
  ${A}
`;function Oe(t){const i={...K,...t};return ge(He,i)}const j=({locked:t,tonCost:i,coinsCost:n,level:l,picture:c,name:h,boxId:B,boxItemType:b})=>{const[x]=Oe({fetchPolicy:"no-cache"}),f=d=>{Y.cache.updateFragment({fragment:A,id:`Box:${d.id}`},()=>d)};return a(F,{children:[a(k,{children:[e("img",{style:{height:40,width:40,marginRight:8},src:c,alt:""}),a(F,{children:[e("span",{style:{fontWeight:"bold"},children:h}),a("span",{style:{color:"var(--tg-theme-hint-color)"},children:["Level ",l]})]})]}),a(k,{children:[e(P,{disabled:t,onClick:async()=>{var m;if(t)return;const d=await x({variables:{boxId:B,boxItemType:b}});d.data&&(window.Telegram.WebApp.HapticFeedback.notificationOccurred("success"),f((m=d.data)==null?void 0:m.upgradeBox))},style:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},children:a(k,{style:{opacity:t?"0.6":1},children:[t&&e("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e("g",{id:"Iconly/Bold/Lock",children:e("g",{id:"Lock",children:e("path",{id:"Lock_2",fillRule:"evenodd",clipRule:"evenodd",d:"M17.5227 7.39601V8.92935C19.2451 9.46696 20.5 11.0261 20.5 12.8884V17.8253C20.5 20.1308 18.5886 22 16.2322 22H7.7688C5.41136 22 3.5 20.1308 3.5 17.8253V12.8884C3.5 11.0261 4.75595 9.46696 6.47729 8.92935V7.39601C6.48745 4.41479 8.95667 2 11.9848 2C15.0535 2 17.5227 4.41479 17.5227 7.39601ZM12.0051 3.73904C14.0678 3.73904 15.7445 5.37871 15.7445 7.39601V8.7137H8.25553V7.37613C8.26569 5.36878 9.94232 3.73904 12.0051 3.73904ZM12.8891 16.4549C12.8891 16.9419 12.4928 17.3294 11.9949 17.3294C11.5072 17.3294 11.1109 16.9419 11.1109 16.4549V14.2488C11.1109 13.7718 11.5072 13.3843 11.9949 13.3843C12.4928 13.3843 12.8891 13.7718 12.8891 14.2488V16.4549Z",fill:"#200E32"})})})}),e(z,{coins:n,type:Q.COIN})]})}),e(P,{style:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},children:e(z,{coins:i,type:Q.TON})})]})]})};var q=(t=>(t.Baits="BAITS",t.Equipment="EQUIPMENT",t))(q||{});function Re({isVisible:t,hide:i,tackleBoxId:n}){const{data:l,loading:c}=Ae({fetchPolicy:"cache-and-network",variables:{boxId:n}});return e(S,{visible:t,title:"Tackle box",onClose:i,children:(()=>{if(!l)return c?e("span",{children:"Loading..."}):null;const{equipmentLevel:B,equipmentLevelUpdateTonCost:b,baitsLevel:x,baitsLevelUpdateCoinsCost:f,baitsLevelUpdateForCoinsPossible:I,baitsLevelUpdateTonCost:d,equipmentLevelUpdateForCoinsPossible:m,equipmentLevelUpdateCoinsCost:w,id:C}=l.tackleBox;return a(F,{children:[e(j,{name:"Fishing equipment",coinsCost:w,tonCost:b,level:B,locked:!m,picture:"/img/equipment.png",boxId:C,boxItemType:q.Equipment}),e("div",{style:{width:"100%",height:1,opacity:.1,background:"var(--tg-theme-text-color)",margin:"8px 0"}}),e(j,{name:"Fishing baits",coinsCost:f,tonCost:d,level:x,locked:!I,picture:"/img/worm.png",boxId:C,boxItemType:q.Baits})]})})()})}function $e({isVisible:t,biting:i,sell:n,release:l}){return e(S,{visible:t,title:"You catch the fish!",accept:{text:a(fe,{children:[e("span",{style:{color:"#fff"},children:"Sell"}),e("img",{style:{margin:"0 5px 0 10px",height:16,width:16},src:"/img/coin.png",alt:""}),e("span",{style:{color:"#fff"},children:i.fish.price})]}),action:()=>n(i.id)},reject:{text:"Release",action:()=>l(i.id)},children:a("div",{style:{display:"flex",alignItems:"center",flexDirection:"column"},children:[e("img",{style:{maxWidth:"100%",maxHeight:"100%"},src:`/img/fish/${i.fish.picture}`,alt:""}),e("span",{style:{fontSize:18,fontWeight:500},children:i.fish.name})]})})}function Me({buttons:t}){return e(me,{children:t.map(({action:i,picture:n})=>e(be,{children:e(xe,{onClick:i,src:n,alt:n})},n))})}function We({onPull:t,onPush:i}){return e("button",{onTouchStart:t,onTouchEnd:i,style:{display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"50%",zIndex:1,position:"absolute",right:16,bottom:100,background:"rgba(255,255,255,.3)",border:"2px solid #fff",height:100,width:100},children:e("img",{style:{height:50,width:50},src:"/img/reels-2-white.png",alt:""})})}const De=G.div`
  min-height: 100vh;
`,ze=G.div`
  max-width: 900px;
  margin: 0 auto;
`;let v=null,g=null;const Qe=.5,L=[50,35];function Ye({user:t,balance:i}){const{tg:n}=ye(),l=ve(),[c,h]=u.useState(L[1]),[B,b]=u.useState(L[0]),[x,f]=u.useState(null),[I,d]=u.useState(!1),[m,w]=u.useState(!1),[C,H]=u.useState(!1),[O,R]=u.useState(!1),[y,$]=u.useState(0),{data:r}=Be({shouldResubscribe:!0,fetchPolicy:"no-cache"}),[M,{data:W}]=Ce({fetchPolicy:"no-cache"}),[_]=Ie({fetchPolicy:"no-cache"}),[X]=we({fetchPolicy:"no-cache"}),T=()=>{clearInterval(v),v=null,clearInterval(g),g=0,h(L[1]),b(L[0]),f(null),$(0)},p=o=>{o.preventDefault()},J=o=>{p(o),y&&(clearInterval(v),g||(g=setInterval(V,50)),v=setInterval(()=>{window.Telegram.WebApp.HapticFeedback.impactOccurred("light"),f(s=>s===null?1:s>=100?(D(),T(),100):(c>0&&h(U=>U-Qe),s+y))},50))},ee=o=>{p(o),y&&(clearInterval(v),g||(g=setInterval(V,50)),v=setInterval(()=>{f(s=>s===null?1:s<=0?(D(),T(),0):(c!==40&&h(U=>U+.05),s-y))},50))},V=()=>{b(o=>{if(o===0||o===100)return o;const s=Math.random();return o+(s>.5?.2:-.2)})},te=()=>{d(!0)},N=()=>{d(!1),T()},ie=()=>{w(!0)},ne=()=>{w(!1)},oe=()=>{l(Pe(Se.FRIENDS))},se=()=>{H(!0)},ae=()=>{H(!1)},D=()=>{try{n.HapticFeedback.notificationOccurred("error"),n.showAlert("Oops... Your fish is gone ðŸ˜¢. Try to pull the fish more carefully")}catch(o){console.error(o)}},le=()=>{R(!0)},re=()=>{R(!1)};u.useEffect(()=>{c<=0&&(r!=null&&r.biting)&&M({variables:{bitingId:r.biting.id}}).then(()=>{window.Telegram.WebApp.HapticFeedback.impactOccurred("rigid"),te(),T()})},[c,r==null?void 0:r.biting,M]),u.useEffect(()=>{r!=null&&r.biting&&($(r.biting.power),window.Telegram.WebApp.HapticFeedback.notificationOccurred("success"),g||(g=setInterval(V,50)))},[r]);const ce=o=>{Y.cache.updateFragment({fragment:Ve,id:`User:${t.id}`},s=>({...s,coins:+s.coins+o}))},de=async o=>{const{data:s}=await _({variables:{bitingId:o}});s&&(ce(s.sellFish),window.Telegram.WebApp.HapticFeedback.notificationOccurred("success")),N()},ue=async o=>{const{data:s}=await X({variables:{bitingId:o}});s&&window.Telegram.WebApp.HapticFeedback.notificationOccurred("success"),N()};return e(De,{children:a(ze,{children:[e(Te,{onTouchStart:p,onTouchEnd:p}),e(Le,{coins:+t.coins,style:{color:"#fff"},balance:i}),x!==null&&e(Ne,{percent:100-x}),e(ke,{onTouchStart:p,onTouchEnd:p,style:{bottom:`${c}%`,left:`${B}%`}}),e(Fe,{onTouchStart:p,onTouchEnd:p}),y>0&&e("h1",{style:{color:"white",position:"absolute",top:100,left:"50%",transform:"translateX(-50%"},children:"BITING!!!"}),e(Me,{buttons:[{picture:"/img/toolbox.png",action:ie},{picture:"/img/leaderboard.png",action:se},{picture:"/img/support.png",action:oe},{picture:"/img/fisher.png",action:le}]}),y>0&&e(We,{onPull:J,onPush:ee}),W&&e($e,{hide:N,isVisible:I,sell:de,release:ue,biting:W.catchFish}),m&&e(Re,{isVisible:m,hide:ne,tackleBoxId:t.tackleBoxId}),C&&e(qe,{isVisible:C,hide:ae}),O&&e(Ue,{hide:re,isVisible:O})]})})}export{Ye as default};
